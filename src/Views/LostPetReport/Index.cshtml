@model LostPetReportsViewModel

@{
    var isBarangayAdmin = Context.Session.GetString("IsBarangayAdmin") == "True";
}

<!-- Main Container with 3D Effect -->
<div class="container my-5">
    <div class="card shadow-lg border-0 rounded-lg" style="transform: perspective(1000px);">
        <div class="card-body">
            <!-- Report Selection Buttons -->
            <div class="text-center mb-4 mt-4">
                @if (isBarangayAdmin)
                {
                    <button id="btn-all-reports" class="btn btn-primary report-btn rounded-pill shadow mx-1" onclick="showReports('all', this)"><i class="fas fa-paw"></i> Lost Pet Reports</button>
                    <button id="btn-found-reports" class="btn btn-success report-btn rounded-pill shadow mx-1" onclick="showReports('found', this)"><i class="fas fa-heart"></i> Found Pets</button>
                }
                else
                {
                    <button id="btn-user-reports" class="btn btn-info report-btn rounded-pill shadow mx-1" onclick="showReports('user', this)"><i class="fas fa-user"></i> My Lost Pet Reports</button>
                    <button id="btn-all-reports" class="btn btn-primary report-btn rounded-pill shadow mx-1" onclick="showReports('all', this)"><i class="fas fa-paw"></i> Lost Pet Reports</button>
                    <button id="btn-found-reports" class="btn btn-success report-btn rounded-pill shadow mx-1" onclick="showReports('found', this)"><i class="fas fa-heart"></i> Found Pets</button>
                }
            </div>

            <!-- Reports Sections -->
            @foreach (var section in new[] { "user", "all", "found" })
            {
                <div id="@($"{section}-reports")" class="row reports-section" style="display: @(section == "user" ? "block" : "none")">
                    <div class="col-12">
                        <div class="d-flex flex-wrap justify-content-between">
                            @foreach (var report in section == "user" ? Model.UserLostPetReports : (section == "all" ? Model.AllLostPetReports : Model.FoundPets))
                            {
                                <div class="col-lg-4 col-md-6 mb-4">
                                    <div class="card shadow-lg border-0 rounded-lg" style="transition: transform 0.3s;">
                                        <div class="card-img-top" onclick="openDetailModal(@report.Id)" style="cursor: pointer;">
                                            <img src="@(report.Photo != null ? $"data:image/jpeg;base64,{Convert.ToBase64String(report.Photo)}" : "path_to_placeholder_image.jpg")" class="img-fluid rounded-top" alt="Pet Photo" />
                                        </div>
                                        <div class="card-header text-center bg-light">
                                            <h5 class="card-title mb-0">@report.Pet.Name</h5>
                                        </div>
                                        <div class="card-body p-3">
                                            <p><strong>Breed:</strong> @report.PetBreed</p>
                                            <p><strong>Gender:</strong> @report.PetGender</p>
                                            <p><strong>Color:</strong> @report.PetColor</p>
                                            <p><strong>Last Seen:</strong> @report.LastSeenLocation</p>
                                            <p><strong>Contact:</strong> @report.OwnerContact</p>
                                            <p><strong>Date:</strong> @report.DateReported?.ToShortDateString()</p>
                                        </div>
                                        <div class="card-footer text-center">
                                            @if (!report.IsFound)
                                            {
                                                <button class="btn btn-outline-success rounded-pill shadow-sm" onclick="openMarkAsFoundModal(@report.Id)">
                                                    <i class="fas fa-check"></i> Mark as Found
                                                </button>
                                            }
                                            else if (section == "all")
                                            {
                                                <p class="text-success"><i class="fas fa-check-circle"></i> Found</p>
                                            }
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<!-- Modal for Details -->
<div class="modal fade" id="detailsModal" tabindex="-1" role="dialog" aria-labelledby="detailsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailsModalLabel">Report Details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="detailsContent">
                <!-- Details will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Modal for Mark as Found -->
<div class="modal fade" id="markAsFoundModal" tabindex="-1" role="dialog" aria-labelledby="markAsFoundModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="markAsFoundModalLabel">Mark Pet as Found</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="reportId" />
                <div class="form-group">
                    <label for="finderName">Finder's Name</label>
                    <input type="text" class="form-control" id="finderName" required />
                </div>
                <div class="form-group">
                    <label for="foundLocation">Location Found</label>
                    <input type="text" class="form-control" id="foundLocation" required />
                </div>
                <div class="form-group">
                    <label for="additionalInfo">Additional Information</label>
                    <textarea class="form-control" id="additionalInfo"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="submitMarkAsFound">Submit</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal HTML remains unchanged -->
@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function showReports(reportType, button) {
            document.querySelectorAll('.reports-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(reportType + '-reports').style.display = 'block';
        }

        function openDetailModal(reportId) {
            $.ajax({
                url: '@Url.Action("GetReportDetails", "LostPetReport")',
                type: 'GET',
                data: { id: reportId },
                success: function (response) {
                    $('#detailsContent').html(response);
                    $('#detailsModal').modal('show');
                },
                error: function (xhr, status, error) {
                    alert('Error fetching report details: ' + error);
                }
            });
        }

        function openMarkAsFoundModal(reportId) {
            $('#reportId').val(reportId);
            $('#markAsFoundModal').modal('show');
        }

        $(document).ready(function () {
            $('#submitMarkAsFound').on('click', function () {
                const reportId = $('#reportId').val();
                const finderName = $('#finderName').val();
                const foundLocation = $('#foundLocation').val();
                const additionalInfo = $('#additionalInfo').val();

                $.ajax({
                    url: '@Url.Action("MarkAsFound", "LostPetReport")',
                    type: 'POST',
                    data: {
                        reportId: reportId,
                        finderName: finderName,
                        foundLocation: foundLocation,
                        additionalInfo: additionalInfo
                    },
                    success: function (response) {
                        $('#markAsFoundModal').modal('hide');
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        alert('Error marking as found: ' + error);
                    }
                });
            });
        });
    </script>
}
